<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Controle de Turno - Pastelaria 24h</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="src/css/style.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'pastel-orange': {
                            50: '#FFF7ED',
                            100: '#FFEDD5',
                            200: '#FED7AA',
                            300: '#FDBA74',
                            400: '#FB923C',
                            500: '#F97316',
                            600: '#EA580C',
                            700: '#C2410C',
                            800: '#9A3412',
                            900: '#7C2D12',
                        },
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    boxShadow: {
                        'card': '0 10px 30px -5px rgba(249, 115, 22, 0.2)',
                        'inner-glow': 'inset 0 2px 4px 0 rgba(249, 115, 22, 0.06)',
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-pattern min-h-screen">
    <header class="bg-header-gradient text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex flex-wrap justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                </svg>
                <h1 class="text-xl font-bold tracking-wide text-white drop-shadow-sm">
                    Pastelaria 24h - Controle de Turno
                </h1>
            </div>
            <div class="flex items-center mt-2 sm:mt-0">
                <div class="mr-4 bg-white bg-opacity-20 rounded-full px-3 py-1 flex items-center">
                    <i class="fa fa-user-circle mr-2"></i>
                    <span id="loggedInUserName" class="font-medium">Carregando...</span>
                </div>
                <button id="logoutButton" class="flex items-center bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-opacity-50">
                    <i class="fa fa-sign-out-alt mr-2"></i> Sair
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto py-6 px-4">
        <div class="bg-white rounded-xl shadow-card mb-8 overflow-hidden">
            <div class="p-6">
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4 mb-6">
                    <button id="btnAbrirTurno" class="w-full sm:w-auto flex items-center justify-center bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg transition-all duration-300 ease-in-out">
                        <i class="fa fa-play-circle mr-2"></i> Abrir Turno
                    </button>
                    <button id="btnFecharTurno" class="w-full sm:w-auto flex items-center justify-center bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-bold py-3 px-8 rounded-lg text-lg shadow-lg transition-all duration-300 ease-in-out" disabled>
                        <i class="fa fa-stop-circle mr-2"></i> Fechar Turno
                    </button>
                </div>
                <div id="turnoStatusContainer" class="text-center">
                    <div id="turnoStatusLoadingIndicator" class="hidden">
                        <div class="inline-flex items-center px-4 py-2 rounded-full bg-blue-50 text-blue-700">
                            <svg class="animate-spin h-4 w-4 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Processando...
                        </div>
                    </div>
                    <p id="turnoStatus" class="text-center text-blue-600 font-semibold mb-4"></p>
                </div>
                <div id="errorMessages" class="text-red-600 text-sm mb-4 text-center font-medium p-3 bg-red-100 border border-red-300 rounded-md hidden"></div>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-card overflow-hidden">
            <div class="p-6">
                <form id="formTurno" class="space-y-8">
                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fa fa-info-circle mr-2"></i>Detalhes do Turno
                        </legend>
                        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-5 mt-2">
                            <div>
                                <label for="turnoMes" class="block text-sm font-medium text-gray-700 mb-1">Mês</label>
                                <input type="text" id="turnoMes" name="turnoMes" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus" readonly>
                            </div>
                            <div>
                                <label for="turnoData" class="block text-sm font-medium text-gray-700 mb-1">Data</label>
                                <input type="date" id="turnoData" name="turnoData" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus" readonly>
                            </div>
                            <div>
                                <label for="turnoResponsavel" class="block text-sm font-medium text-gray-700 mb-1">Responsável</label>
                                <input type="text" id="turnoResponsavel" name="turnoResponsavel" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus" readonly>
                            </div>
                            <div>
                                <label for="turnoHora" class="block text-sm font-medium text-gray-700 mb-1">Hora Abertura</label>
                                <input type="time" id="turnoHora" name="turnoHora" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-100 shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus" readonly>
                            </div>
                            <div>
                                <label for="turnoPeriodo" class="block text-sm font-medium text-gray-700 mb-1">Período</label>
                                <select id="turnoPeriodo" name="turnoPeriodo" class="w-full p-3 border border-gray-300 rounded-lg bg-gray-50 shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus">
                                    <option value="Manhã-07-15">Manhã (07:00 - 15:00)</option>
                                    <option value="Tarde-14-21">Tarde (14:00 - 21:00)</option>
                                    <option value="Noite-21-07">Noite (21:00 - 07:00)</option>
                                    <option value="Tarde-14-22">Tarde (14:00 - 22:00)</option>
                                    <option value="Manhã-07-19">Manhã (07:00 - 19:00)</option>
                                    <option value="Noite-19-2330">Noite (19:00 - 23:30)</option>
                                    <option value="Noite-19-07">Noite (19:00 - 07:00)</option>
                                </select>
                            </div>
                        </div>
                    </fieldset>

                    <div class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-lg">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-amber-400 text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-amber-800 font-semibold">Nova Funcionalidade: Controle de Chegadas</h3>
                                <p class="text-amber-700 text-sm mt-1">
                                    A coluna <strong>"Chegadas"</strong> é para registrar produtos que chegam durante o turno.
                                    <br>Cálculo: <strong>Vendido = (Entrada + Chegadas) - Sobra - Descarte - Consumo</strong>
                                    <br>Exemplo: Entrada 10 + Chegadas 50 - Sobra 10 = 50 vendidos
                                </p>
                            </div>
                        </div>
                    </div>

                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm item-section" data-category="pasteis">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-utensils mr-2"></i>Pastéis
                        </legend>
                        <div class="table-scroll-container">
                            <div class="scrollable-table-wrapper">
                                <table class="scrollable-table min-w-full divide-y divide-gray-200 custom-table sm:text-sm text-xs">
                                    <thead>
                                        <tr>
                                            <th class="px-3 py-3 text-left text-xs font-medium tracking-wider sticky left-0 bg-yellow-100 z-10">
                                                Sabor
                                            </th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Entrada</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider col-chegadas">Chegadas</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Sobra</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Descarte</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Consumo Func.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Vendido</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Preço Unit.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Total Item</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaPasteis" class="bg-white divide-y divide-gray-200"></tbody>
                                    <tbody id="tabelaCasquinhas" class="bg-white divide-y divide-gray-200 border-t-2 border-pastel-orange-300 mt-2 pt-2"></tbody>
                                    <tfoot class="bg-pastel-orange-50">
                                        <tr class="font-semibold text-gray-700">
                                            <td class="px-3 py-2 text-right" colspan="6">Total Pastéis Comuns:</td>
                                            <td id="totalPasteisComunsVendido" class="px-2 py-2 text-center">0</td>
                                            <td></td>
                                            <td id="totalPasteisComunsValor" class="px-2 py-2">R$ 0.00</td>
                                        </tr>
                                        <tr class="font-semibold text-gray-700">
                                            <td class="px-3 py-2 text-right" colspan="6">Total Pastéis Especiais:</td>
                                            <td id="totalPasteisEspeciaisVendido" class="px-2 py-2 text-center">0</td>
                                            <td></td>
                                            <td id="totalPasteisEspeciaisValor" class="px-2 py-2">R$ 0.00</td>
                                        </tr>
                                        <tr class="font-semibold text-gray-700">
                                            <td class="px-3 py-2 text-right" colspan="6">Total Casquinhas:</td>
                                            <td id="totalCasquinhasVendido" class="px-2 py-2 text-center">0</td>
                                            <td></td>
                                            <td id="totalCasquinhasValor" class="px-2 py-2">R$ 0.00</td>
                                        </tr>
                                        <tr class="font-bold text-pastel-orange-600 text-md bg-pastel-orange-100">
                                            <td class="px-3 py-3 text-right" colspan="6">TOTAL GERAL DE PASTÉIS (C+E):</td>
                                            <td id="totalGeralPasteisVendido" class="px-2 py-3 text-center">0</td>
                                            <td></td>
                                            <td id="totalGeralPasteisValor" class="px-2 py-3">R$ 0.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm item-section" data-category="caldo_cana">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-glass-whiskey mr-2"></i>Caldo de Cana
                        </legend>
                        <div class="table-scroll-container">
                            <div class="scrollable-table-wrapper">
                                <table class="scrollable-table min-w-full divide-y divide-gray-200 custom-table sm:text-sm text-xs">
                                    <thead>
                                        <tr>
                                            <th class="px-3 py-3 text-left text-xs font-medium tracking-wider sticky left-0 bg-yellow-100 z-10">
                                                Item
                                            </th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Entrada</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider col-chegadas">Chegadas</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Sobra</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Descarte</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Consumo Func.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Vendido</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Preço Unit.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Total Item</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaCaldoCana" class="bg-white divide-y divide-gray-200"></tbody>
                                    <tfoot class="bg-pastel-orange-50">
                                        <tr class="font-bold text-pastel-orange-600 text-md bg-pastel-orange-100">
                                            <td class="px-3 py-3 text-right" colspan="6">TOTAL CALDO DE CANA:</td>
                                            <td id="totalCaldoCanaVendido" class="px-2 py-3 text-center">0</td>
                                            <td></td>
                                            <td id="totalCaldoCanaValor" class="px-2 py-3">R$ 0.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm item-section" data-category="refrigerantes">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-bottle-water mr-2"></i>Refrigerantes e Bebidas
                        </legend>
                        <div class="table-scroll-container">
                            <div class="scrollable-table-wrapper">
                                <table class="scrollable-table min-w-full divide-y divide-gray-200 custom-table sm:text-sm text-xs">
                                    <thead>
                                        <tr>
                                            <th class="px-3 py-3 text-left text-xs font-medium tracking-wider sticky left-0 bg-yellow-100 z-10">
                                                Item
                                            </th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Entrada</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider col-chegadas">Chegadas</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Sobra</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Descarte</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Consumo Func.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Vendido</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Preço Unit.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Total Item</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaRefrigerantes" class="bg-white divide-y divide-gray-200"></tbody>
                                    <tfoot class="bg-pastel-orange-50">
                                        <tr class="font-bold text-pastel-orange-600 text-md bg-pastel-orange-100">
                                            <td class="px-3 py-3 text-right" colspan="6">TOTAL REFRIGERANTES E BEBIDAS:</td>
                                            <td id="totalRefrigerantesVendido" class="px-2 py-3 text-center">0</td>
                                            <td></td>
                                            <td id="totalRefrigerantesValor" class="px-2 py-3">R$ 0.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </fieldset>
                    
                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm item-section" data-category="gelo">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-cube mr-2"></i>Gelo
                        </legend>
                        <div class="table-scroll-container">
                            <div class="scrollable-table-wrapper">
                                <table class="scrollable-table min-w-full divide-y divide-gray-200 custom-table sm:text-sm text-xs">
                                    <thead>
                                        <tr>
                                            <th class="px-3 py-3 text-left text-xs font-medium tracking-wider sticky left-0 bg-yellow-100 z-10">
                                                Item
                                            </th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Entrada (Pct)</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider col-chegadas">Chegadas (Pct)</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Sobra (Pct)</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Vendas (Pct)</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">
                                                <span class="flex items-center">
                                                    Consumo Interno (Pct)
                                                    <i class="fas fa-calculator ml-1 text-blue-500" title="Calculado automaticamente"></i>
                                                </span>
                                            </th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Preço Pct.</th>
                                            <th class="px-2 py-3 text-left text-xs font-medium tracking-wider">Total Venda Gelo</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tabelaGelo" class="bg-white divide-y divide-gray-200"></tbody>
                                    <tfoot class="bg-pastel-orange-50">
                                        <tr class="font-bold text-pastel-orange-600 text-md bg-pastel-orange-100">
                                            <td class="px-3 py-3 text-right" colspan="7">TOTAL VENDA DE GELO:</td>
                                            <td id="totalGeloValor" class="px-2 py-3">R$ 0.00</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                        <div class="mt-2 text-xs text-gray-600 italic flex items-center">
                            <i class="fas fa-info-circle mr-1 text-blue-500"></i>
                            Consumo interno é calculado automaticamente: (Entrada + Chegadas) - Sobra - Vendas
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-fire mr-2"></i>Botijão de Gás
                        </legend>
                        <div class="flex items-center space-x-4 mt-2">
                            <label for="trocaGas" class="block text-sm font-medium text-gray-700">Houve troca de botijão neste turno?</label>
                            <select id="trocaGas" name="trocaGas" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus">
                                <option value="nao">Não</option>
                                <option value="sim">Sim</option>
                            </select>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm" id="secaoFuncionariosColaboradores">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-users mr-2"></i>Funcionários Colaboradores no Turno
                        </legend>
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg mb-4">
                            <div class="flex items-start">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-info-circle text-blue-400 text-xl"></i>
                                </div>
                                <div class="ml-3">
                                    <p class="text-blue-700 text-sm">
                                        Registre aqui os funcionários que trabalharam com você neste turno. 
                                        As informações serão salvas no perfil de cada funcionário automaticamente.
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div id="funcionariosColaboradoresContainer" class="space-y-4"></div>
                        <div class="mt-4 flex justify-center">
                            <button type="button" id="btnAdicionarFuncionario" 
                                    class="flex items-center bg-pastel-orange-500 hover:bg-pastel-orange-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-pastel-orange-500 focus:ring-opacity-50">
                                <i class="fas fa-plus-circle mr-2"></i>
                                Adicionar Funcionário Colaborador
                            </button>
                        </div>
                    </fieldset>

                    <fieldset class="border border-gray-200 p-6 rounded-lg shadow-sm">
                        <legend class="text-lg font-semibold text-pastel-orange-600 px-2 bg-white">
                            <i class="fas fa-cash-register mr-2"></i>Controle de Caixa
                        </legend>
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-md font-semibold text-gray-700 mb-3 border-b pb-2 flex items-center">
                                    <i class="fas fa-sign-in-alt mr-2 text-green-500"></i>Caixa Inicial
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="caixaInicialDinheiro" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-money-bill-wave mr-1"></i>Dinheiro
                                        </label>
                                        <input type="text" id="caixaInicialDinheiro" name="caixaInicialDinheiro" 
                                            class="w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus" 
                                            placeholder="R$ 0,00" readonly>
                                    </div>
                                    <div>
                                        <label for="caixaInicialMoedas" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-coins mr-1"></i>Moedas
                                        </label>
                                        <input type="text" id="caixaInicialMoedas" name="caixaInicialMoedas" 
                                            class="w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus" 
                                            placeholder="R$ 0,00" readonly>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                                <label for="totalVendidoTurnoCalculado" class="block text-sm font-medium text-blue-700 mb-1">
                                    <i class="fas fa-calculator mr-1"></i> Total Vendido no Turno (Calculado Pelos Itens)
                                </label>
                                <input type="text" id="totalVendidoTurnoCalculado" name="totalVendidoTurnoCalculado"
                                    class="w-full p-3 border border-blue-200 rounded-lg bg-blue-100 shadow-inner font-semibold text-blue-800" readonly placeholder="R$ 0,00">
                            </div>
                            
                            <div>
                                <h3 class="text-md font-semibold text-gray-700 mt-6 mb-3 border-b pb-2 flex items-center">
                                    <i class="fas fa-credit-card mr-2 text-blue-500"></i>Valores Finais por Forma de Pagamento (Fechamento)
                                </h3>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                    <div>
                                        <label for="pagamentoDinheiro" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-money-bill-wave mr-1"></i> Dinheiro (R$)
                                        </label>
                                        <input type="text" id="pagamentoDinheiro" name="pagamentoDinheiro" 
                                            class="payment-input w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                    <div>
                                        <label for="pagamentoPixManual" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-qrcode mr-1"></i> PIX Manual (R$)
                                        </label>
                                        <input type="text" id="pagamentoPixManual" name="pagamentoPixManual" 
                                            class="payment-input w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                    <div>
                                        <label for="pagamentoStoneDCV" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-credit-card mr-1"></i> Stone D/C/V (R$)
                                        </label>
                                        <input type="text" id="pagamentoStoneDCV" name="pagamentoStoneDCV" 
                                            class="payment-input w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                    <div>
                                        <label for="pagamentoStoneVoucher" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-ticket-alt mr-1"></i> Stone Voucher (R$)
                                        </label>
                                        <input type="text" id="pagamentoStoneVoucher" name="pagamentoStoneVoucher" 
                                            class="payment-input w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                    <div>
                                        <label for="pagamentoPagBankDCV" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-credit-card mr-1"></i> PAGBANK D/C/V (R$)
                                        </label>
                                        <input type="text" id="pagamentoPagBankDCV" name="pagamentoPagBankDCV" 
                                            class="payment-input w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                    <div class="bg-green-50 p-4 rounded-lg border border-green-100 sm:col-span-2 lg:col-span-1">
                                        <label for="totalRegistradoPagamentos" class="block text-sm font-medium text-green-700 mb-1">
                                            <i class="fas fa-check-circle mr-1"></i> Total Registrado (Soma Automática)
                                        </label>
                                        <input type="text" id="totalRegistradoPagamentos" name="totalRegistradoPagamentos"
                                            class="w-full p-3 border border-green-200 rounded-lg bg-green-100 shadow-inner font-semibold text-green-800" readonly placeholder="R$ 0,00">
                                    </div>
                                </div>
                            </div>
                            <div id="salesDivergenceAlert" class="mt-4 p-4 rounded-lg border hidden"></div>
                            
                            <div>
                                <h3 class="text-md font-semibold text-gray-700 mt-6 mb-3 border-b pb-2 flex items-center">
                                    <i class="fas fa-sign-out-alt mr-2 text-red-500"></i>Caixa Final (Contagem Física)
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label for="caixaFinalDinheiro" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-money-bill-wave mr-1"></i>Dinheiro Contado
                                        </label>
                                        <input type="text" id="caixaFinalDinheiro" name="caixaFinalDinheiro" 
                                            class="w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                    <div>
                                        <label for="caixaFinalMoedas" class="block text-sm font-medium text-gray-700 mb-1">
                                            <i class="fas fa-coins mr-1"></i>Moedas Contadas
                                        </label>
                                        <input type="text" id="caixaFinalMoedas" name="caixaFinalMoedas" 
                                            class="w-full p-3 border border-gray-300 rounded-lg shadow-inner focus:ring-pastel-orange-500 focus:border-pastel-orange-500 input-focus"
                                            placeholder="R$ 0,00">
                                    </div>
                                </div>
                                <div class="mt-4 p-4 rounded-lg border" id="caixaDiferencaContainer">
                                    <label for="caixaDiferenca" class="block text-sm font-medium mb-1">
                                        <i class="fas fa-balance-scale-right mr-1"></i>Diferença de Caixa Físico
                                    </label>
                                    <input type="text" id="caixaDiferenca" name="caixaDiferenca" readonly
                                        class="w-full p-3 border rounded-lg bg-gray-100 shadow-inner font-semibold">
                                    <p id="divergenciaCaixaAlerta" class="text-xs mt-2 italic"></p>
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    
                    <div id="fechamentoDivergenciaAlertaGeral" class="mt-6 p-5 bg-red-100 border border-red-300 rounded-lg text-red-700 font-semibold text-center hidden"></div>
                </form>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-gray-300 py-6 mt-10">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-4 md:mb-0">
                    <p class="text-lg font-semibold flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z" />
                        </svg>
                        Pastelaria 24h
                    </p>
                    <p class="text-sm text-gray-400">Sistema de Controle de Caixa • v2.1</p>
                </div>
                <div class="text-sm text-gray-400">
                    <p>© 2023-2025 • Todos os direitos reservados</p>
                    <p class="mt-1">Desenvolvido com tecnologias modernas para seu negócio</p>
                </div>
            </div>
        </div>
    </footer>

    <div id="connection-status" class="fixed bottom-4 right-4 flex items-center px-3 py-2 rounded-full text-sm font-medium hidden">
        <span class="status-icon w-2 h-2 rounded-full mr-2"></span>
        <span class="status-text"></span>
    </div>

    <script src="src/js/firebase-config.js"></script>
    <script src="src/js/shared.js"></script>
    <script src="src/js/auth.js"></script>
    <script src="src/js/funcionario-controller.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            protectRoute(['funcionario']);

            function updateConnectionStatus() {
                const statusEl = document.getElementById('connection-status');
                if (!statusEl) return;
                const statusIcon = statusEl.querySelector('.status-icon');
                const statusText = statusEl.querySelector('.status-text');
                
                if (navigator.onLine) {
                    statusEl.classList.remove('bg-red-100', 'text-red-700', 'hidden');
                    statusEl.classList.add('bg-green-100', 'text-green-700');
                    if (statusIcon) {
                         statusIcon.classList.remove('bg-red-500');
                         statusIcon.classList.add('bg-green-500');
                    }
                    if (statusText) statusText.textContent = 'Conectado';
                    
                    setTimeout(() => {
                        statusEl.classList.add('fade-out');
                        setTimeout(() => {
                            statusEl.classList.add('hidden');
                            statusEl.classList.remove('fade-out');
                        }, 1000);
                    }, 3000);
                } else {
                    statusEl.classList.remove('hidden', 'bg-green-100', 'text-green-700');
                    statusEl.classList.add('bg-red-100', 'text-red-700');
                     if (statusIcon) {
                        statusIcon.classList.remove('bg-green-500');
                        statusIcon.classList.add('bg-red-500');
                    }
                    if (statusText) statusText.textContent = 'Sem conexão';
                }
                 statusEl.classList.remove('hidden');
            }
            
            window.addEventListener('online', updateConnectionStatus);
            window.addEventListener('offline', updateConnectionStatus);
            updateConnectionStatus();
            
            function showLoadingState(isLoading) {
                const loadingIndicator = document.getElementById('turnoStatusLoadingIndicator');
                if (!loadingIndicator) return;
                if (isLoading) {
                    loadingIndicator.classList.remove('hidden');
                } else {
                    loadingIndicator.classList.add('hidden');
                }
            }
            
            setTimeout(() => {
                const mainElement = document.querySelector('main');
                if (mainElement) mainElement.classList.add('fade-in');
            }, 100);
        });
    </script>
</body>
</html>