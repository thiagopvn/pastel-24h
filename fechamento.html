<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fechamento Semanal - Pastelaria 24h</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="src/css/style.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap">
    
    <!-- SheetJS para exportar Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <!-- html2pdf para exportar PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#FFF7ED',
                            100: '#FFEDD5',
                            200: '#FED7AA',
                            300: '#FDBA74',
                            400: '#FB923C',
                            500: '#F97316',
                            600: '#EA580C',
                            700: '#C2410C',
                            800: '#9A3412',
                            900: '#7C2D12',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>

        .table-container input[type="number"] {
        min-height: 40px !important;
        font-size: 16px !important;
        padding: 8px 12px !important;
        border: 2px solid #e5e7eb !important;
        border-radius: 6px !important;
        text-align: center !important;
        font-weight: 500 !important;
        min-width: 80px !important;
    }
    
    .table-container input[type="number"]:focus {
        outline: none !important;
        border-color: #f97316 !important;
        box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1) !important;
        background-color: #fff7ed !important;
    }
    
    /* Células da tabela maiores */
    #fechamentoTable td {
        padding: 8px 4px !important;
        min-width: 90px !important;
    }
    
    #fechamentoTable th {
        padding: 12px 8px !important;
        font-size: 14px !important;
    }
    
    /* Primeira coluna (nomes) maior */
    .sticky-col {
        min-width: 150px !important;
        font-size: 15px !important;
    }
    
    /* Células de totais com destaque */
    #fechamentoTable td[id*="_total_"],
    #fechamentoTable td[id*="_consumo"] {
        font-size: 16px !important;
        font-weight: 600 !important;
        padding: 10px !important;
    }
    
    /* Total a receber ainda maior */
    #fechamentoTable td[id*="_total_receber"] {
        font-size: 18px !important;
        font-weight: 700 !important;
        background-color: #fef3c7 !important;
    }
    
    /* Linha de totais gerais */
    .total-row td {
        font-size: 16px !important;
        padding: 12px 8px !important;
        font-weight: 700 !important;
    }
    
    #total_geral_receber {
        font-size: 20px !important;
        background-color: #fbbf24 !important;
        color: #7c2d12 !important;
    }
    
    /* Inputs de desconto e adicional destacados */
    input[id*="_desconto"] {
        background-color: #fee2e2 !important;
        border-color: #fca5a5 !important;
    }
    
    input[id*="_adicional"] {
        background-color: #dcfce7 !important;
        border-color: #86efac !important;
    }
    
    /* Hover nas células editáveis */
    .editable-cell:hover {
        background-color: #fef3c7 !important;
    }
    
    /* Aumentar altura mínima das linhas */
    #fechamentoTable tr {
        min-height: 60px;
    }

        .editable-cell input[type="number"] {
        min-height: 36px !important;
        font-size: 1rem !important;
        padding: 0.5rem !important;
    }
    
    .table-container input:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
    }
        .table-container {
            max-height: calc(100vh - 300px);
            overflow: auto;
        }
        
        /* Estilo para células editáveis */
        .editable-cell:hover {
            background-color: #FEF3C7;
        }
        
        .editable-cell input {
            background: transparent;
            border: none;
            width: 100%;
            text-align: center;
            padding: 0.25rem;
        }
        
        .editable-cell input:focus {
            background: white;
            border: 2px solid #F97316;
            border-radius: 0.375rem;
            outline: none;
        }
        
        /* Fixar primeira coluna */
        .sticky-col {
            position: sticky;
            left: 0;
            z-index: 10;
            background: white;
        }
        
        /* Estilo para totais */
        .total-row {
            background: linear-gradient(to right, #FFF7ED, #FED7AA);
            font-weight: 600;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-primary-600 to-primary-700 text-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center">
                        <i class="fas fa-calculator text-lg"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Fechamento Semanal</h1>
                        <p class="text-primary-100 text-sm">Cálculo de Pagamentos</p>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <button onclick="window.location.href='admin.html'" class="flex items-center bg-white bg-opacity-20 hover:bg-opacity-30 text-white font-medium py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-arrow-left mr-2"></i>
                        Voltar
                    </button>
                    
                    <div class="flex items-center space-x-2 bg-white bg-opacity-10 rounded-full px-3 py-1">
                        <i class="fas fa-user-shield"></i>
                        <span id="loggedInUserName" class="font-medium">Admin</span>
                    </div>
                    
                    <button id="logoutButton" class="flex items-center bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-sign-out-alt mr-2"></i>
                        Sair
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-6">
        <!-- Controles -->
        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Seletor de Período -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-calendar-alt mr-1 text-primary-500"></i>
                        Período (Segunda a Domingo)
                    </label>
                    <div class="flex space-x-2">
                        <input type="date" id="dataInicio" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                        <span class="flex items-center px-2">até</span>
                        <input type="date" id="dataFim" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                    </div>
                    <button id="btnSemanaAtual" class="mt-2 text-sm text-primary-600 hover:text-primary-700">
                        <i class="fas fa-redo mr-1"></i>Semana Atual
                    </button>
                </div>
                
                <!-- Valor Hora -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        <i class="fas fa-money-bill-wave mr-1 text-primary-500"></i>
                        Valor Hora (R$)
                    </label>
                    <input type="number" id="valorHora" value="10.00" step="0.01" min="0" 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500">
                </div>
                
                <!-- Botões de Ação -->
                <div class="flex items-end space-x-2">
                    <button id="btnCarregar" class="flex-1 bg-primary-500 hover:bg-primary-600 text-white font-medium py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-sync-alt mr-2"></i>Carregar Dados
                    </button>
                    <button id="btnExportExcel" class="bg-green-500 hover:bg-green-600 text-white font-medium py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-file-excel"></i>
                    </button>
                    <button id="btnExportPDF" class="bg-red-500 hover:bg-red-600 text-white font-medium py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-file-pdf"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Status/Loading -->
        <div id="statusContainer" class="hidden bg-blue-50 border border-blue-200 text-blue-700 p-4 rounded-lg mb-6">
            <i class="fas fa-spinner fa-spin mr-2"></i>
            <span id="statusMessage">Carregando dados...</span>
        </div>

        <!-- Tabela -->
        <div class="bg-white rounded-xl shadow-sm overflow-hidden">
            <div class="table-container">
                <table id="fechamentoTable" class="w-full">
                    <thead>
                        <!-- Cabeçalho será preenchido dinamicamente -->
                    </thead>
                    <tbody>
                        <!-- Corpo será preenchido dinamicamente -->
                    </tbody>
                    <tfoot>
                        <!-- Rodapé com totais será preenchido dinamicamente -->
                    </tfoot>
                </table>
            </div>
            
            <!-- Mensagem quando não há dados -->
            <div id="emptyMessage" class="p-8 text-center text-gray-500">
                <i class="fas fa-inbox text-4xl mb-4"></i>
                <p>Selecione um período e clique em "Carregar Dados"</p>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="src/js/firebase-config.js"></script>
    <script src="src/js/shared.js"></script>
    <script src="src/js/auth.js"></script>
    <script src="src/js/fechamento.js"></script>
</body>
</html>