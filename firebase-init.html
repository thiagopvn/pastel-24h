
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicialização do Firebase - Pastelaria 24h</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-lg shadow-lg p-8">
            <h1 class="text-3xl font-bold text-center mb-8 text-orange-600">
                <i class="fas fa-database mr-2"></i>Inicialização do Firebase
            </h1>
            
            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Status da Configuração</h2>
                <div id="status" class="space-y-2"></div>
            </div>
            
            <div class="space-y-4">
                <button onclick="initializeEverything()" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition-all">
                    <i class="fas fa-play mr-2"></i>Inicializar Tudo
                </button>
                
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="createProductsCollection()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-tag mr-2"></i>Criar Coleção de Produtos
                    </button>
                    
                    <button onclick="createSampleUsers()" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all">
                        <i class="fas fa-users mr-2"></i>Criar Usuários de Exemplo
                    </button>
                </div>
            </div>
            
            <div id="log" class="mt-8 bg-gray-50 p-4 rounded-lg max-h-96 overflow-y-auto font-mono text-sm"></div>
        </div>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAFiDHRY_DuJ6pLzDmR-M2bNhzgxsX9doE",
            authDomain: "projetopastel-24h.firebaseapp.com",
            projectId: "projetopastel-24h",
            storageBucket: "projetopastel-24h.firebasestorage.app",
            messagingSenderId: "348495095024",
            appId: "1:348495095024:web:b3e49b8ef1909e4e7ece35",
            measurementId: "G-0D4BNK64Z7"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Função para adicionar log
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const colors = {
                info: 'text-blue-600',
                success: 'text-green-600',
                error: 'text-red-600',
                warning: 'text-yellow-600'
            };
            
            logDiv.innerHTML += `<div class="${colors[type]}">[${timestamp}] ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        // Função para atualizar status
        async function updateStatus() {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = '<div class="text-gray-500">Verificando estrutura do banco...</div>';
            
            try {
                // Verificar coleção de produtos
                const produtosSnapshot = await db.collection('produtos').get();
                const produtosStatus = produtosSnapshot.empty ? 
                    '<span class="text-red-500"><i class="fas fa-times-circle"></i> Coleção de produtos não existe</span>' :
                    `<span class="text-green-500"><i class="fas fa-check-circle"></i> Coleção de produtos OK (${produtosSnapshot.size} categorias)</span>`;
                
                // Verificar coleção de usuários
                const usuariosSnapshot = await db.collection('usuarios').get();
                const usuariosStatus = usuariosSnapshot.empty ? 
                    '<span class="text-red-500"><i class="fas fa-times-circle"></i> Coleção de usuários vazia</span>' :
                    `<span class="text-green-500"><i class="fas fa-check-circle"></i> Coleção de usuários OK (${usuariosSnapshot.size} usuários)</span>`;
                
                // Verificar coleção de turnos
                const turnosSnapshot = await db.collection('turnos').get();
                const turnosStatus = `<span class="text-blue-500"><i class="fas fa-info-circle"></i> Coleção de turnos: ${turnosSnapshot.size} documentos</span>`;
                
                statusDiv.innerHTML = `
                    <div class="space-y-2">
                        <div>${produtosStatus}</div>
                        <div>${usuariosStatus}</div>
                        <div>${turnosStatus}</div>
                    </div>
                `;
            } catch (error) {
                statusDiv.innerHTML = `<div class="text-red-500">Erro ao verificar status: ${error.message}</div>`;
            }
        }
        
        // Criar coleção de produtos
        async function createProductsCollection() {
            addLog('Iniciando criação da coleção de produtos...', 'info');
            
            const produtos = {
                pasteis: {
                    carne: { preco: 8.00 },
                    frango: { preco: 8.00 },
                    queijo: { preco: 8.00 },
                    pizza: { preco: 8.00 },
                    bauru: { preco: 8.00 },
                    calabresa: { preco: 8.00 },
                    palmito: { preco: 8.00 },
                    especial_de_carne: { preco: 10.00 },
                    especial_de_frango: { preco: 10.00 },
                    especial_de_calabresa: { preco: 10.00 }
                },
                casquinhas: {
                    casquinha_simples: { preco: 3.00 },
                    casquinha_com_cobertura: { preco: 4.00 },
                    casquinha_com_granulado: { preco: 4.50 }
                },
                caldo_cana: {
                    caldo_de_cana_300ml: { preco: 5.00 },
                    caldo_de_cana_500ml: { preco: 7.00 },
                    caldo_de_cana_700ml: { preco: 9.00 },
                    caldo_de_cana_1litro: { preco: 12.00 }
                },
                refrigerantes: {
                    coca_cola_350ml: { preco: 5.00 },
                    coca_cola_600ml: { preco: 7.00 },
                    coca_cola_2l: { preco: 12.00 },
                    guarana_350ml: { preco: 5.00 },
                    guarana_600ml: { preco: 7.00 },
                    guarana_2l: { preco: 12.00 },
                    fanta_laranja_350ml: { preco: 5.00 },
                    fanta_laranja_600ml: { preco: 7.00 },
                    fanta_laranja_2l: { preco: 12.00 },
                    fanta_uva_350ml: { preco: 5.00 },
                    sprite_350ml: { preco: 5.00 },
                    agua_mineral_500ml: { preco: 3.00 }
                },
                gelo: {
                    gelo_pacote: { preco: 5.00 }
                }
            };
            
            try {
                const batch = db.batch();
                
                Object.keys(produtos).forEach(categoria => {
                    addLog(`Criando categoria: ${categoria}`, 'info');
                    const docRef = db.collection('produtos').doc(categoria);
                    batch.set(docRef, produtos[categoria]);
                });
                
                await batch.commit();
                addLog('✅ Coleção de produtos criada com sucesso!', 'success');
                updateStatus();
            } catch (error) {
                addLog(`❌ Erro ao criar produtos: ${error.message}`, 'error');
            }
        }
        
        // Criar usuários de exemplo
        async function createSampleUsers() {
            addLog('Criando usuários de exemplo...', 'info');
            addLog('⚠️ IMPORTANTE: Você precisa criar os usuários no Firebase Authentication primeiro!', 'warning');
            addLog('Use estes emails/senhas no Firebase Console:', 'warning');
            addLog('admin@pastelaria24h.com / senha123', 'warning');
            addLog('funcionario@pastelaria24h.com / senha123', 'warning');
            
            // Após criar no Firebase Auth, copie os UIDs e substitua aqui:
            const usuarios = [
                {
                    uid: 'COLE_O_UID_DO_ADMIN_AQUI', // Substitua pelo UID real
                    nome: 'Administrador',
                    email: 'admin@pastelaria24h.com',
                    role: 'admin'
                },
                {
                    uid: 'COLE_O_UID_DO_FUNCIONARIO_AQUI', // Substitua pelo UID real
                    nome: 'Funcionário Teste',
                    email: 'funcionario@pastelaria24h.com',
                    role: 'funcionario'
                }
            ];
            
            try {
                for (const usuario of usuarios) {
                    if (usuario.uid.includes('COLE_O_UID')) {
                        addLog(`⚠️ Substitua o UID do usuário ${usuario.nome} pelo UID real do Firebase Auth`, 'warning');
                        continue;
                    }
                    
                    await db.collection('usuarios').doc(usuario.uid).set({
                        nome: usuario.nome,
                        email: usuario.email,
                        role: usuario.role,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    addLog(`✅ Usuário ${usuario.nome} criado`, 'success');
                }
                
                updateStatus();
            } catch (error) {
                addLog(`❌ Erro ao criar usuários: ${error.message}`, 'error');
            }
        }
        
        // Inicializar tudo
        async function initializeEverything() {
            addLog('=== INICIANDO CONFIGURAÇÃO COMPLETA ===', 'info');
            
            // Verificar autenticação
            const user = auth.currentUser;
            if (!user) {
                addLog('⚠️ Você precisa estar logado como administrador para executar este script', 'warning');
                return;
            }
            
            addLog(`✅ Logado como: ${user.email}`, 'success');
            
            // Criar produtos
            await createProductsCollection();
            
            // Informar sobre usuários
            addLog('', 'info');
            addLog('=== PRÓXIMOS PASSOS ===', 'info');
            addLog('1. Vá ao Firebase Console > Authentication', 'info');
            addLog('2. Crie dois usuários com email/senha:', 'info');
            addLog('   - admin@pastelaria24h.com', 'info');
            addLog('   - funcionario@pastelaria24h.com', 'info');
            addLog('3. Copie os UIDs gerados', 'info');
            addLog('4. Use a função "Criar Usuários de Exemplo" com os UIDs corretos', 'info');
            
            addLog('', 'info');
            addLog('✅ Configuração inicial concluída!', 'success');
        }
        
        // Verificar status ao carregar
        window.onload = async () => {
            // Verificar se está autenticado
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    addLog(`Autenticado como: ${user.email}`, 'success');
                    await updateStatus();
                } else {
                    addLog('⚠️ Você precisa fazer login primeiro no sistema principal', 'warning');
                    addLog('Redirecionando para a página de login em 3 segundos...', 'info');
                    setTimeout(() => {
                        window.location.href = 'index.html';
                    }, 3000);
                }
            });
        };
    </script>
</body>
</html>